<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3D Colorful Secure Media Gallery</title>
    <link rel="stylesheet" href="/static/gallery.css">
</head>

<body>

    <h1>3D Colorful Secure Media Gallery</h1>
    <p>Welcome, {{ session['user']['name'] }}!</p>

    <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>

    <div id="upload-section">
        <h2>Upload Any File (Image / MP4 / MP3 / PDF)</h2>

        {% if upload_error %}
            <p class="error">{{ upload_error }}</p>
        {% endif %}

        <form method="POST" enctype="multipart/form-data">
            <input type="file" name="file" required>
            <input type="submit" value="Upload">
        </form>
    </div>

    <h2>Your Media</h2>

    <div id="gallery-container">
        {% for file in files %}
            <div class="thumbnail-container" onclick="openLightbox({{ loop.index0 }})">
                <!-- actions -->
                <button class="icon-btn delete-btn"
                        onclick="event.stopPropagation(); deleteFile('{{ file.blob_name }}')">
                    üóë
                </button>
                <button class="icon-btn share-btn"
                        onclick="event.stopPropagation(); shareFile('{{ file.blob_name }}')">
                    üîó
                </button>

                {% if file.type == 'image' %}
                    <img src="{{ file.url }}" class="thumbnail">

                {% elif file.type == 'video' %}
                    <video class="thumbnail" muted>
                        <source src="{{ file.url }}" type="video/mp4">
                    </video>

                {% elif file.type == 'audio' %}
                    <div class="audio-box">üéµ Audio File</div>

                {% elif file.type == 'pdf' %}
                    <div class="pdf-box">üìÑ PDF File</div>

                {% else %}
                    <div class="other-box">üìÅ File</div>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <!-- LIGHTBOX -->
    <div id="lightboxOverlay" class="lightbox-overlay">
        <span class="close-button" onclick="closeLightbox()">&times;</span>
        <span class="prev-button" onclick="changeItem(-1)">&#10094;</span>
        <span class="next-button" onclick="changeItem(1)">&#10095;</span>

        <div class="lightbox-content">
            <img id="lightboxImage" class="lightbox-img" style="display:none;">
            <video id="lightboxVideo" class="lightbox-video" controls style="display:none;"></video>
            <audio id="lightboxAudio" class="lightbox-audio" controls style="display:none;"></audio>
            <iframe id="lightboxPDF" class="lightbox-pdf" style="display:none;"></iframe>
        </div>
    </div>

    <script>
        const mediaFiles = {{ files | tojson }};
    </script>
    <script src="/static/gallery.js"></script>

</body>
</html>
